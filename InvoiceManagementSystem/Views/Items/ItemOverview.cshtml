@*@model InvoiceManagementSystem.ViewModels.ItemsViewModels*@
@{
    ViewData["Title"] = "ItemOverview";
    Layout = "~/Views/Shared/_DashboardLayout.cshtml";
}

<div class="container-fluid">
    <div class="row">
        <div class="col-4">
            <!---Check box Card start-->
            <div class="card card-primary card-outline">
                <div class="card-header">
                    <h2 class="card-title col-9" style="">All Items</h2>
                    <a class="col-2 " asp-controller="Items" asp-action="AddItems" style=""><i class="fa fa-plus"> New</i></a>
                </div>
                <!-- /.card-header -->
                <div class="card-body p-0">
                    <div class="table-responsive mailbox-messages" id="divTable">
                        <table id="MailBoxTable" class="table table-hover table-striped">
                        </table>
                    </div>
                    <!-- /.mail-box-messages -->
                </div>
            </div>
            <!-- End Checkbox card -->
        </div>
        <!--Items Detail Card Start-->
        <!-- /.col -->
        <div class="col-8" id="myDisplay">
        </div>

        <!-- /.content -->
    </div>
</div>

<script src="~/lib/jquery-3.6.0.js"></script>
<script>

    $(document).ready(function () {
        $.ajax({
            type: 'GET',
            url: '/Items/ItemOverviewList',
            dataType: 'json',
            success: function (allItems) {
                console.log(allItems);
                var myRow;
                var myCard;
                $.each(allItems, function (index, item) {

                    myRow = '<tr class="upd" target="' + item.id + '"><td id="updDiv"><div target="' + item.id + '"  class="icheck-primary"> <input type="checkbox" value="" class="master' + item.id + '" id="check"> </div></td><td class="mailbox-name"><a>' + item.name + '</a></td></tr>';
                    $('#MailBoxTable').append(myRow);
                    myCard = '<div class="card" id="card' + item.id + '" style="display:none" ><div class="card-header" data-card-widget="collapse" ><h1>' + item.name + '</h1> <h3 class="card-title">Overview</h3><div class="card-tools"><div class="divTool" target="' + item.id + '"><input type="text" id="divInput' + item.id + '" value="' + item.id + '" style="display:none"><button type="button" id="btneditItem" class="btn btn-tool"><i class="fas fa-edit"></i></button><a type="button" id="btnDelete' + item.id + '" target="' + item.id + '" class="btn btn-tool"><i class="fas fa-trash"></i></a></div></div></div><div class="card-body"><div class="row"><div class="col-4">Item type</div><div class="col-8"><b>' + item.type + '</b></div></div><div class="row"><div class="col-4">Created Source</div><div class="col-8"><b></b></div></div><br /><div class="row"><div class="col-4"><b>Sales Information</b></div></div><div class="row"><div class="col-4">Selling Price</div><div class="col-8"><b>PKR ' + item.sellingPrice + '</b></div></div><div class="row"><div class="col-4">Description</div><div class="col-8">' + item.description + '</div></div></div></div >'
                    $('#myDisplay').append(myCard);

                });

                $('.icheck-primary').click(function () {
                    if ($('.master' + $(this).attr('target')).is(":checked")) {
                        $('#card' + $(this).attr('target')).show();
                    }
                    else {
                        $('#card' + $(this).attr('target')).hide();
                    }
                });

                $('.divTool').click(function () {
                    $('#btnDelete' + $(this).attr('target')).click(function () {

                        var proceed = confirm("do you want to Delete An item ?");
                        if (proceed)
                        {
                            Div_id = $('#divInput' + $(this).attr('target')).val();
                            console.log(Div_id);
                            var objDelete = { id: Div_id };
                            console.log(objDelete);
                            $.ajax({
                                type: 'POST',
                                url: '/Items/ItemDelete',
                                data: objDelete,
                                success: function (msg) {
                                    objDelete = {};
                                    location.reload();
                                }
                            });
                        }
                        else
                        {
                            location.reload();
                        }
                    });
                });

            },
            error: function () {
                /* $('#termoneError').text('An error occurred');*/
            }
        });
    });




</script>
